## æ’ä»¶åº“å¯è§æ€§ä¼˜åŒ–æ€»ç»“

### ğŸ”’ **å®ç°ç›®æ ‡**
å°† `plugin_lossy_ddl` åº“çš„å†…éƒ¨å®ç°ç»†èŠ‚è®¾ç½®ä¸ºä»…åº“å†…å¯è§ (`pub(crate)`)ï¼Œé¿å…å…¶ä»–åº“ç›´æ¥ä¾èµ–å†…éƒ¨ç±»å‹ï¼Œåªä¿ç•™æ’ä»¶æ¥å£ä¸ºå…¬å…±æ¥å£ã€‚

### ğŸ“ **ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨**

#### **1. `src/lib.rs` - åº“å…¥å£**
- âœ… å°†å†…éƒ¨æ¨¡å—æ”¹ä¸º `pub(crate)`ï¼š`error`ã€`types`ã€`analyzer`
- âœ… ä¿ç•™æ’ä»¶æ¨¡å—ä¸º `pub mod plugin`
- âœ… åªå¯¼å‡ºå¿…è¦çš„å…¬å…±æ¥å£ï¼š`AnalysisResult`ã€`RiskLevel`ã€`LossyDDLPlugin`ã€`DDLAnalysisHandler`
- âœ… ç§»é™¤ä¸å¿…è¦çš„å†…éƒ¨ç±»å‹å¯¼å‡ºï¼š`PrecheckResult`ã€`DDLError`ã€`DDLResult`

#### **2. `src/types.rs` - æ•°æ®ç±»å‹**
- âœ… ä¿æŒ `AnalysisResult` ä¸ºå…¬å…±ç»“æ„ï¼Œä½†å°†å†…éƒ¨å­—æ®µè®¾ä¸º `pub(crate)`ï¼š
  - `warnings: Vec<String>` â†’ `pub(crate) warnings`
  - `analyzed_patterns: Vec<String>` â†’ `pub(crate) analyzed_patterns`
- âœ… åˆ é™¤æœªä½¿ç”¨çš„ç±»å‹åˆ«å `PrecheckResult`
- âœ… å°† `RiskLevel` çš„è¾…åŠ©æ–¹æ³•æ”¹ä¸º `pub(crate)`ï¼š
  - `description()` - ä»…å†…éƒ¨ä½¿ç”¨
  - `emoji()` - ä»…å†…éƒ¨ä½¿ç”¨
- âœ… åˆ é™¤æœªä½¿ç”¨çš„ `is_lossy()` æ–¹æ³•

#### **3. `src/error.rs` - é”™è¯¯ç±»å‹**
- âœ… å°†æ•´ä¸ª `DDLError` æšä¸¾æ”¹ä¸º `pub(crate)`
- âœ… åˆ é™¤æœªä½¿ç”¨çš„é”™è¯¯å˜ä½“ï¼š`ParseError`ã€`ConfigError`
- âœ… åˆ é™¤æœªä½¿ç”¨çš„ç±»å‹åˆ«å `DDLResult`
- âœ… åªä¿ç•™å®é™…ä½¿ç”¨çš„é”™è¯¯ç±»å‹ï¼š`InvalidInput`ã€`TiDBError`

#### **4. `src/analyzer.rs` - åˆ†æå™¨**
- âœ… å°†ä¸»åˆ†æå‡½æ•° `analyze_sql()` æ”¹ä¸º `pub(crate)`
- âœ… æ‰€æœ‰å†…éƒ¨è¾…åŠ©å‡½æ•°ä¿æŒç§æœ‰ï¼ˆé»˜è®¤å¯è§æ€§ï¼‰

#### **5. `src/plugin.rs` - æ’ä»¶æ¥å£**
- âœ… ä¿æŒæ’ä»¶ç›¸å…³ç±»å‹ä¸ºå…¬å…±æ¥å£ï¼š
  - `pub struct LossyDDLPlugin`
  - `pub struct DDLAnalysisHandler`
- âœ… ä¿æŒæ’ä»¶æ–¹æ³•ä¸ºå…¬å…±æ¥å£ï¼Œä¾›å¤–éƒ¨è°ƒç”¨

### ğŸ¯ **å¯è§æ€§ç­–ç•¥**

| ç»„ä»¶ç±»å‹ | å¯è§æ€§ | è¯´æ˜ |
|---------|---------|------|
| **æ’ä»¶æ¥å£** | `pub` | ä¾›å…¶ä»–åº“å’Œç³»ç»Ÿé›†æˆä½¿ç”¨ |
| **ä¸»è¦ç»“æœç±»å‹** | `pub` | API è¿”å›ç±»å‹ï¼Œéœ€è¦å¤–éƒ¨è®¿é—® |
| **å†…éƒ¨æ•°æ®å­—æ®µ** | `pub(crate)` | åº“å†…éƒ¨ä½¿ç”¨ï¼Œé¿å…å¤–éƒ¨ç›´æ¥è®¿é—® |
| **å†…éƒ¨ç±»å‹å’Œå‡½æ•°** | `pub(crate)` | åº“å†…è·¨æ¨¡å—è®¿é—® |
| **è¾…åŠ©å‡½æ•°** | `private` | å•æ¨¡å—å†…ä½¿ç”¨ |

### âœ… **éªŒè¯ç»“æœ**
- âœ… `plugin_lossy_ddl` åŒ…ç¼–è¯‘æˆåŠŸï¼Œä»…æœ‰1ä¸ªå…³äºæœªä½¿ç”¨å­—æ®µçš„è­¦å‘Š
- âœ… `backend` åŒ…ç¼–è¯‘æˆåŠŸï¼Œèƒ½æ­£å¸¸ä½¿ç”¨æ’ä»¶æ¥å£
- âœ… æ’ä»¶åŠŸèƒ½å®Œæ•´ä¿ç•™ï¼Œå¤–éƒ¨ API æ¥å£ä¸å˜
- âœ… å†…éƒ¨å®ç°ç»†èŠ‚æœ‰æ•ˆéšè—ï¼Œæé«˜å°è£…æ€§

### ğŸ” **å…¬å…±æ¥å£æ¸…å•**
ä»¥ä¸‹æ˜¯å…¶ä»–åº“å¯ä»¥ä½¿ç”¨çš„å…¬å…±æ¥å£ï¼š

```rust
// ä¸»è¦åˆ†æå‡½æ•°
pub fn precheck_sql_with_collation(sql: &str, collation_enabled: bool) -> AnalysisResult;

// è¿”å›ç»“æœç±»å‹
pub struct AnalysisResult {
    pub is_lossy: bool,
    pub risk_level: RiskLevel,
    pub error: Option<String>,
    // å…¶ä»–å­—æ®µä¸ºåº“å†…å¯è§
}

// é£é™©çº§åˆ«æšä¸¾
pub enum RiskLevel {
    Safe,
    High,
}

// æ’ä»¶æ¥å£
pub struct LossyDDLPlugin { /* ... */ }
pub struct DDLAnalysisHandler { /* ... */ }
```

### ğŸ‰ **ä¼˜åŒ–æ•ˆæœ**
1. **æ›´å¥½çš„å°è£…æ€§**ï¼šå†…éƒ¨å®ç°ç»†èŠ‚ä¸ä¼šè¢«å¤–éƒ¨è¯¯ç”¨
2. **API ç¨³å®šæ€§**ï¼šå‡å°‘å…¬å…±æ¥å£ï¼Œé™ä½ breaking change é£é™©
3. **ä»£ç æ¸…æ´**ï¼šåˆ é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œå‡å°‘ç¼–è¯‘è­¦å‘Š
4. **å‘å‰å…¼å®¹**ï¼šä¿æŒæ ¸å¿ƒ API ä¸å˜ï¼Œç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
