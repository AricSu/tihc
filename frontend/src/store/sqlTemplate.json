[
  {
    "key": "top-slow",
    "en-label": "Top 10 Slowest Queries",
    "zh-label": "Top 10 慢查询",
    "en-category": "slow",
    "zh-category": "慢查询",
    "template": "SELECT \n    Time,\n    Query_time,\n    wait_time,\n    Process_time,\n    Prewrite_time,\n    Plan_digest,\n    Query \nFROM information_schema.cluster_slow_query \nWHERE Time >= '2025-06-12 10:00:00' \n    AND Time <= '2025-06-12 11:00:00' \nORDER BY Query_time DESC \nLIMIT 10;"
  },
  {
    "key": "long-running",
    "en-label": "Top 10 Queries by Execution Count",
    "zh-label": "Top 10 执行次数最多的查询",
    "en-category": "slow",
    "zh-category": "慢查询",
    "template": "SELECT \n    Digest, \n    COUNT(*) AS exec_count, \n    MAX(Query_time) AS max_query_time, \n    ROUND(AVG(Query_time), 2) AS avg_query_time, \n    SUM(Query_time) AS total_query_time, \n    LEFT(MIN(Query), 300) AS SUB_query\nFROM information_schema.cluster_slow_query\nWHERE Time >= '2025-06-12 10:00:00' \n    AND Time <= '2025-06-12 11:00:00'\nGROUP BY Digest\nORDER BY exec_count DESC\nLIMIT 10;"
  },
  {
    "key": "hot-region",
    "en-label": "Top 10 Hot Region",
    "zh-label": "Top 10 热点 Region",
    "en-category": "region",
    "zh-category": "热点 Region",
    "template": "SELECT \n    REGION_ID, \n    TABLE_NAME, \n    INDEX_NAME, \n    AVG(FLOW_BYTES) AS AVG_FLOW_BYTES \nFROM \n    TIDB_HOT_REGIONS_HISTORY \nWHERE \n    STORE_ID = \"1\"\n    AND UPDATE_TIME >= '2025-06-12 10:00:00'\n    AND UPDATE_TIME <= '2025-06-12 11:00:00'\nGROUP BY \n    REGION_ID, \n    TABLE_NAME, \n    INDEX_NAME \nORDER BY \n    AVG_FLOW_BYTES DESC \nLIMIT 10;"
  },
  {
    "key": "hot-region",
    "en-label": "Split Table Regions",
    "zh-label": "手动切分表 Region",
    "en-category": "region",
    "zh-category": "热点 Region",
    "template": "-- Region 详情\nSELECT * FROM information_schema.tikv_region_status WHERE region_id={{REGION_ID}};\n\n-- 查看指定表 region key 范围\nSELECT START_KEY, TIDB_DECODE_KEY(START_KEY), END_KEY, TIDB_DECODE_KEY(END_KEY) FROM information_schema.tikv_region_status WHERE  DB_NAME = 'dh_app_1709' AND TABLE_NAME='dh_active';\n\n-- 查看 region key 范围\nSELECT START_KEY, TIDB_DECODE_KEY(START_KEY) AS lower_BOUND, END_KEY, TIDB_DECODE_KEY(END_KEY) AS upper_BOUND FROM information_schema.tikv_region_status WHERE  TABLE_ID={{TABLE_ID}};\n\n-- 拆分表 region\nSPLIT TABLE table_name BETWEEN {{LOWER_BOUND}} AND {{UPPER_BOUND}} REGIONS region_num;\n\n-- 禁止合并\nALTER TABLE {TABLE_NAME} ATTRIBUTES 'merge_option=deny';\n\n"
  },
  {
    "key": "top-tiflash",
    "en-label": "Top 10 Queries by Execution Count",
    "zh-label": "Top 10 Tiflash 执行次数最多的查询",
    "en-category": "Tiflash",
    "zh-category": "Tiflash",
    "template": "SELECT \n    query_time,\n    sql_text,\n    user,\n    host,\n    rows_examined,\n    rows_sent\nFROM information_schema.cluster_tiflash_query \nWHERE time >= NOW() - INTERVAL 1 HOUR\nORDER BY query_time DESC \nLIMIT 10;"
  },
  {
    "key": "estimated-by-stats",
    "en-label": "Table Storage Estimated by Statistics",
    "zh-label": "按统计信息估算表磁盘占用",
    "en-category": "disk",
    "zh-category": "磁盘",
    "template": "SELECT \n    table_schema AS `Database`, \n    SUM(data_length + index_length) / 1024 / 1024 / 1024 AS `Size (GB)` \nFROM information_schema.tables \nWHERE table_schema NOT IN ('mysql','INFORMATION_SCHEMA','METRICS_SCHEMA', 'PERFORMANCE_SCHEMA', 'sys') \nGROUP BY table_schema;"
  },
  {
    "key": "estimated-by-region",
    "en-label": "Table Storage Estimated by Region",
    "zh-label": "按 Region 估算表磁盘占用",
    "en-category": "disk",
    "zh-category": "磁盘",
    "template": "SELECT \n    db_name, \n    table_name, \n    ROUND(SUM(total_size / cnt), 2) AS Approximate_Size,\n    ROUND(SUM(total_size / cnt / (\n        SELECT ROUND(AVG(value), 2)\n        FROM METRICS_SCHEMA.store_size_amplification\n        WHERE value > 0\n    )), 2) AS Disk_Size\nFROM (\n    SELECT \n        db_name, \n        table_name, \n        region_id, \n        SUM(Approximate_Size) AS total_size, \n        COUNT(*) AS cnt\n    FROM information_schema.TIKV_REGION_STATUS\n    WHERE db_name = @dbname\n        AND table_name IN (@table_name)\n    GROUP BY db_name, table_name, region_id\n) tabinfo\nGROUP BY db_name, table_name;"
  }
]