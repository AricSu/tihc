[
  {
    "key": "top-slow",
    "en-label": "Top 10 Slowest Queries",
    "zh-label": "Top 10 慢查询",
    "en-category": "slow",
    "zh-category": "慢查询",
    "template": "select Time,Query_time,wait_time,Process_time,Prewrite_time,Plan_digest,Query from information_schema.cluster_slow_query where Time >= '2025-06-12 10:00:00' and Time <= '2025-06-12 11:00:00' order by Query_time desc limit 10;"
  },
  {
    "key": "long-running",
    "en-label": "Top 10 Queries by Execution Count",
    "zh-label": "Top 10 执行次数最多的查询",
    "en-category": "slow",
    "zh-category": "慢查询",
    "template": "SELECT Digest, COUNT(*) AS exec_count, MAX(Query_time) AS max_query_time, ROUND(AVG(Query_time), 2) AS avg_query_time, SUM(Query_time) AS total_query_time, LEFT(MIN(Query), 300) AS SUB_query\nFROM information_schema.cluster_slow_query\nWHERE Time >= '2025-06-12 10:00:00' AND Time <= '2025-06-12 11:00:00'\nGROUP BY Digest\nORDER BY exec_count DESC\nLIMIT 10;"
  },
  {
    "key": "hot-region",
    "en-label": "Top 10 Hot Region",
    "zh-label": "Top 10 热点 Region",
    "en-category": "region",
    "zh-category": "热点 Region",
    "template": "SELECT \n    REGION_ID, \n    TABLE_NAME, \n    INDEX_NAME, \n    AVG(FLOW_BYTES) AS AVG_FLOW_BYTES \nFROM \n    TIDB_HOT_REGIONS_HISTORY \nWHERE \n    STORE_ID = \"1\"\n    AND UPDATE_TIME >= '2025-06-12 10:00:00'\n    AND UPDATE_TIME <= '2025-06-12 11:00:00'\nGROUP BY \n    REGION_ID, \n    TABLE_NAME, \n    INDEX_NAME \nORDER BY \n    AVG_FLOW_BYTES DESC \nLIMIT 10;"
  },
  {
    "key": "hot-region",
    "en-label": "Split Table Regions",
    "zh-label": "手动切分表 Region",
    "en-category": "region",
    "zh-category": "热点 Region",
    "template": "-- Region 详情\nSELECT * FROM information_schema.tikv_region_status WHERE region_id={{REGION_ID}};\n\n-- 查看指定表 region key 范围\nSELECT START_KEY, TIDB_DECODE_KEY(START_KEY), END_KEY, TIDB_DECODE_KEY(END_KEY) FROM information_schema.tikv_region_status WHERE  DB_NAME = 'dh_app_1709' AND TABLE_NAME='dh_active';\n\n-- 查看 region key 范围\nSELECT START_KEY, TIDB_DECODE_KEY(START_KEY) AS lower_BOUND, END_KEY, TIDB_DECODE_KEY(END_KEY) AS upper_BOUND FROM information_schema.tikv_region_status WHERE  TABLE_ID={{TABLE_ID}};\n\n-- 拆分表 region\nSPLIT TABLE table_name BETWEEN {{LOWER_BOUND}} AND {{UPPER_BOUND}} REGIONS region_num;\n\n-- 禁止合并\nALTER TABLE {TABLE_NAME} ATTRIBUTES 'merge_option=deny';\n\n"
  },
  {
    "key": "top-tiflash",
    "en-label": "Top 10 Queries by Execution Count",
    "zh-label": "Top 10 Tiflash 执行次数最多的查询",
    "en-category": "Tiflash",
    "zh-category": "Tiflash",
    "template": "SELECT \n    query_time,\n    sql_text,\n    user,\n    host,\n    rows_examined,\n    rows_sent\nFROM information_schema.cluster_tiflash_query \nWHERE time >= NOW() - INTERVAL 1 HOUR\nORDER BY query_time DESC \nLIMIT 10;"
  },
  {
    "key": "estimated-by-stats",
    "en-label": "Table Storage Estimated by Statistics",
    "zh-label": "按统计信息估算表磁盘占用",
    "en-category": "disk",
    "zh-category": "磁盘",
    "template": "SELECT table_schema AS `Database`, SUM(data_length + index_length) / 1024 / 1024 / 1024 AS `Size (GB)` FROM information_schema.tables WHERE table_schema not in ('mysql','INFORMATION_SCHEMA','METRICS_SCHEMA', 'PERFORMANCE_SCHEMA', 'sys') GROUP BY table_schema;"
  },
  {
    "key": "estimated-by-region",
    "en-label": "Table Storage Estimated by Region",
    "zh-label": "按 Region 估算表磁盘占用",
    "en-category": "disk",
    "zh-category": "磁盘",
    "template": "SELECT db_name, table_name, ROUND(SUM(total_size / cnt), 2) Approximate_Size,\nROUND(SUM(total_size / cnt / (\nSELECT ROUND(AVG(value), 2)\nFROM METRICS_SCHEMA.store_size_amplification\nWHERE value > 0\n)), 2) Disk_Size\nFROM (\nSELECT db_name, table_name, region_id, SUM(Approximate_Size) total_size, COUNT(*) cnt\nFROM information_schema.TIKV_REGION_STATUS\nWHERE db_name = @dbname\nAND table_name IN (@table_name)\nGROUP BY db_name, table_name, region_id\n) tabinfo\nGROUP BY db_name, table_name;"
  }
]