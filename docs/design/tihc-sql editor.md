---

## ğŸ“œ **TiDB Intelligent Health Check (tihc) - åŠŸèƒ½æ¨¡å—æ–‡æ¡£ï¼ˆç²¾ç®€ç‰ˆï¼‰**

---

### 1. **æ•°æ®åº“ç®¡ç†**

æä¾›å¯¹æ•°æ®åº“çš„å¢åˆ æŸ¥æ”¹æ“ä½œï¼Œæ”¯æŒåˆ›å»ºæ•°æ®åº“ã€æŸ¥çœ‹æ•°æ®åº“ç­‰ã€‚

#### 1.1 è·å–æ‰€æœ‰æ•°æ®åº“åˆ—è¡¨

* **æ¥å£**ï¼š`GET /api/databases`
* **æè¿°**ï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ä¿¡æ¯ã€‚
* **å“åº”ä½“**ï¼š

  ```json
  {
    "data": [
      {
        "id": 1,
        "name": "database1",
        "engine": "MySQL",
        "createdAt": "2023-01-01T00:00:00Z"
      },
      {
        "id": 2,
        "name": "database2",
        "engine": "PostgreSQL",
        "createdAt": "2023-02-01T00:00:00Z"
      }
    ]
  }
  ```

#### 1.2 åˆ›å»ºæ•°æ®åº“

* **æ¥å£**ï¼š`POST /api/databases`
* **æè¿°**ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚
* **è¯·æ±‚ä½“**ï¼š

  ```json
  {
    "name": "new_database",
    "engine": "MySQL"
  }
  ```
* **å“åº”ä½“**ï¼š

  ```json
  {
    "id": 3,
    "name": "new_database",
    "engine": "MySQL",
    "createdAt": "2023-07-01T00:00:00Z"
  }
  ```

#### 1.3 åˆ é™¤æ•°æ®åº“

* **æ¥å£**ï¼š`DELETE /api/databases/{database_id}`
* **æè¿°**ï¼šåˆ é™¤æŒ‡å®šçš„æ•°æ®åº“ã€‚
* **å“åº”ä½“**ï¼š

  ```json
  {
    "status": "success",
    "message": "Database deleted successfully"
  }
  ```

---

### 2. **è¡¨å’Œå­—æ®µç®¡ç†**

ç®¡ç†æ•°æ®åº“ä¸­çš„è¡¨åŠå­—æ®µã€‚åŒ…æ‹¬è·å–è¡¨ç»“æ„ã€æ·»åŠ å­—æ®µç­‰åŠŸèƒ½ã€‚

#### 2.1 è·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨

* **æ¥å£**ï¼š`GET /api/tables?databaseId={database_id}`
* **æè¿°**ï¼šè·å–æŒ‡å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ä¿¡æ¯ã€‚
* **å“åº”ä½“**ï¼š

  ```json
  {
    "data": [
      {
        "name": "users",
        "columns": [
          {"name": "id", "type": "INT"},
          {"name": "name", "type": "VARCHAR"}
        ]
      },
      {
        "name": "orders",
        "columns": [
          {"name": "id", "type": "INT"},
          {"name": "amount", "type": "FLOAT"}
        ]
      }
    ]
  }
  ```

#### 2.2 æ·»åŠ å­—æ®µåˆ°è¡¨ä¸­

* **æ¥å£**ï¼š`POST /api/tables/{table_id}/add_column`
* **æè¿°**ï¼šå‘æŒ‡å®šè¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µã€‚
* **è¯·æ±‚ä½“**ï¼š

  ```json
  {
    "column_name": "new_column",
    "column_type": "VARCHAR"
  }
  ```
* **å“åº”ä½“**ï¼š

  ```json
  {
    "status": "success",
    "message": "Column added successfully"
  }
  ```

#### 2.3 åˆ é™¤è¡¨ä¸­çš„å­—æ®µ

* **æ¥å£**ï¼š`DELETE /api/tables/{table_id}/columns/{column_name}`
* **æè¿°**ï¼šåˆ é™¤æŒ‡å®šè¡¨ä¸­çš„æŸä¸ªå­—æ®µã€‚
* **å“åº”ä½“**ï¼š

  ```json
  {
    "status": "success",
    "message": "Column deleted successfully"
  }
  ```

---

### 3. **SQL æ‰§è¡Œ**

æä¾›æ‰§è¡Œ SQL æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ç­‰åŠŸèƒ½ã€‚

#### 3.1 æ‰§è¡Œ SQL è¯­å¥

* **æ¥å£**ï¼š`POST /api/sql/execute`
* **æè¿°**ï¼šæ‰§è¡ŒæŒ‡å®šçš„ SQL æŸ¥è¯¢æˆ–æ“ä½œã€‚
* **è¯·æ±‚ä½“**ï¼š

  ```json
  {
    "databaseId": 1,
    "sql": "SELECT * FROM users WHERE id = 1"
  }
  ```
* **å“åº”ä½“**ï¼š

  ```json
  {
    "status": "success",
    "data": [
      {
        "id": 1,
        "name": "Alice",
        "email": "alice@example.com"
      }
    ]
  }
  ```

#### 3.2 è·å– SQL æ‰§è¡ŒçŠ¶æ€

* **æ¥å£**ï¼š`GET /api/sql/status/{task_id}`
* **æè¿°**ï¼šæŸ¥è¯¢æŒ‡å®šä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚
* **å“åº”ä½“**ï¼š

  ```json
  {
    "status": "completed",
    "message": "SQL query executed successfully",
    "data": [
      {
        "id": 1,
        "name": "Alice"
      }
    ]
  }
  ```

---

### 4. **å®æ—¶æ¨é€ä¸é€šçŸ¥**

æä¾› SQL æ‰§è¡Œè¿›åº¦å’Œä»»åŠ¡æ›´æ–°çš„å®æ—¶é€šçŸ¥ã€‚

#### 4.1 ä½¿ç”¨ SSE æ¨é€ SQL æ‰§è¡Œè¿›åº¦

* **æ¥å£**ï¼š`GET /api/notifications`
* **æè¿°**ï¼šä½¿ç”¨ SSE æ¨é€å®æ—¶é€šçŸ¥å’Œè¿›åº¦ã€‚
* **è¯·æ±‚å¤´**ï¼š

  ```http
  Accept: text/event-stream
  ```
* **å“åº”ä½“**ï¼š

  ```http
  data: {"status": "running", "message": "SQL is being executed..."}
  ```

---

## æ€»ç»“

è¿™ä»½æ–‡æ¡£æ¶µç›–äº† **TiDB Intelligent Health Check (tihc)** åç«¯ä¸å‰ç«¯äº¤äº’çš„æ ¸å¿ƒ API è®¾è®¡å’ŒåŠŸèƒ½å®ç°ã€‚ä¸»è¦åŒ…æ‹¬ï¼š

1. **æ•°æ®åº“ç®¡ç†**ï¼šæ”¯æŒåˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤æ•°æ®åº“ã€‚
2. **è¡¨å’Œå­—æ®µç®¡ç†**ï¼šæ”¯æŒæŸ¥çœ‹è¡¨ç»“æ„ã€æ·»åŠ å­—æ®µã€åˆ é™¤å­—æ®µã€‚
3. **SQL æ‰§è¡Œ**ï¼šæ”¯æŒæ‰§è¡Œ SQL æŸ¥è¯¢ã€è·å–æ‰§è¡ŒçŠ¶æ€ã€‚
4. **å®æ—¶æ¨é€ä¸é€šçŸ¥**ï¼šé€šè¿‡ SSE æ¨é€ SQL æ‰§è¡Œè¿›åº¦ã€‚

è¿™äº› API èƒ½å¤Ÿæ”¯æŒåŠ¨æ€æ“ä½œæ•°æ®åº“ç»“æ„ã€æ‰§è¡Œ SQL æŸ¥è¯¢ç­‰åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶æä¾›å®æ—¶åé¦ˆã€‚



å¸®æˆ‘éå†æ•´ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰æ²¡ç”¨ vue native admin è¯­æ³•æˆ–è€…åŠŸèƒ½å®ç°çš„é€»è¾‘å…¨éƒ¨æ‰¾å‡ºï¼Œå¹¶ç”¨ vue native admin è¯­æ³•é‡å†™ï¼Œä¸€ä¸ªä¹Ÿä¸è¦æ¼æ‰